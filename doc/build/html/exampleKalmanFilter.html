


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Kalman Filter &#8212; OpenVD  documentation</title>
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.base.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sinusoidal Steering" href="exampleSinusoidalSteering.html" />
    <link rel="prev" title="Examples" href="example.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="exampleSinusoidalSteering.html" title="Sinusoidal Steering"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="example.html" title="Examples"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">OpenVD  documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="example.html" accesskey="U">Examples</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="kalman-filter">
<span id="id1"></span><h1>Kalman Filter<a class="headerlink" href="#kalman-filter" title="Permalink to this headline">Â¶</a></h1>
<p>Consider a nonlinear system given by the stochastic differential equation</p>
<div class="math notranslate nohighlight">
\[\dot{{\bf x}} = {\bf f} ( {\bf x}(t) , t ) + {\bf G} (t) {\bf w} (t)\]</div>
<p>where</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\({\bf w}\)</span> is a white gaussian process. <span class="math notranslate nohighlight">\({\bf w}(t)\)</span> ~ <span class="math notranslate nohighlight">\(N ( {\bf 0} , {\bf Q}(t) )\)</span></li>
<li><span class="math notranslate nohighlight">\({\bf f} ( {\bf x}(t) , t )\)</span> is a function vector of dimension <span class="math notranslate nohighlight">\(n\)</span></li>
<li><span class="math notranslate nohighlight">\({\bf x}(t)\)</span> is the state vector <span class="math notranslate nohighlight">\((n \times 1)\)</span></li>
<li><span class="math notranslate nohighlight">\({\bf G}\)</span> is a known matrix <span class="math notranslate nohighlight">\((n \times s)\)</span></li>
</ul>
<p>In this example, the plant is represented by the nonlinear model described in <a class="reference internal" href="simpleVehicleModels.html#vehicle-simple-3dof"><span class="std std-ref">Simple vehicle 3 DOF</span></a>.</p>
<p>The system model used in the algorithm is based on the plant model. Moreover, we assume that the designer of the Kalman Filter do not possess full knowledge of the characteristic curve of the tire. Thus, the vehicle model of the algorithm is the same used to represent the real vehicle. However, the tire model used is linear (<a class="reference internal" href="tire.html#tire-linear"><span class="std std-ref">Linear</span></a>). This way, the system model used in the Kalman Filter algorithm is a nonlinear vehicle model with linear tire model.</p>
<p>Defining the tire and nonlinear vehicle models with the default parameters. This model will represent the real vehicle system in the simulation environment.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">TirePlant</span> <span class="p">=</span> <span class="n">TirePacejka</span><span class="p">;</span>
<span class="n">VehiclePlant</span> <span class="p">=</span> <span class="n">VehicleSimpleNonlinear</span><span class="p">;</span>
<span class="n">VehiclePlant</span><span class="p">.</span><span class="n">tire</span> <span class="p">=</span> <span class="n">TirePlant</span><span class="p">;</span>
</pre></div>
</div>
<p>Lets simulate the vehicle maneuver to be estimated by the Kalman Filter.</p>
<p>The chosen simulation parameters are</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="p">=</span> <span class="mi">6</span><span class="p">;</span>                              <span class="c">% Total simulation time [s]</span>
<span class="n">resol</span> <span class="p">=</span> <span class="mi">50</span><span class="p">;</span>                         <span class="c">% Resolution</span>
<span class="n">TSPAN</span> <span class="p">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">T</span><span class="o">/</span><span class="n">resol</span><span class="p">:</span><span class="n">T</span><span class="p">;</span>                <span class="c">% Time span [s]</span>
</pre></div>
</div>
<p>Initializing the simulator and simulating.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">simulatorPlant</span> <span class="p">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">VehiclePlant</span><span class="p">,</span> <span class="n">TSPAN</span><span class="p">);</span>
<span class="n">simulatorPlant</span><span class="p">.</span><span class="n">dPSI0</span> <span class="p">=</span> <span class="mf">0.35</span><span class="p">;</span>
<span class="n">simulatorPlant</span><span class="p">.</span><span class="n">Simulate</span>
</pre></div>
</div>
<p>Retrieving state responses</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">XTPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">XT</span><span class="p">;</span>
<span class="n">YTPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">YT</span><span class="p">;</span>
<span class="n">PSIPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">PSI</span><span class="p">;</span>
<span class="n">vTPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">VEL</span><span class="p">;</span>
<span class="n">ALPHATPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">ALPHAT</span><span class="p">;</span>
<span class="n">dPSIPlant</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">dPSI</span><span class="p">;</span>

<span class="n">XOUTPlant</span> <span class="p">=</span> <span class="p">[</span><span class="n">XTPlant</span> <span class="n">YTPlant</span> <span class="n">PSIPlant</span> <span class="n">vTPlant</span> <span class="n">ALPHATPlant</span> <span class="n">dPSIPlant</span><span class="p">];</span>
</pre></div>
</div>
<p>Generating the graphics of the maneuver.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gPlant</span> <span class="p">=</span> <span class="n">Graphics</span><span class="p">(</span><span class="n">simulatorPlant</span><span class="p">);</span>
<span class="n">gPlant</span><span class="p">.</span><span class="n">TractorColor</span> <span class="p">=</span> <span class="s">&#39;r&#39;</span><span class="p">;</span>
<span class="n">gPlant</span><span class="p">.</span><span class="n">Frame</span><span class="p">();</span>
</pre></div>
</div>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/KalmanFilterFrame1.svg"><img alt="_images/KalmanFilterFrame1.svg" src="_images/KalmanFilterFrame1.svg" width="70%" /></a>
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Leegend</span></p>
</div>
<p>Now, the model used in thhe Kalman Filter algorithm is presented.</p>
<p>Initializing the tire and vehicle models</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">TireModel</span> <span class="p">=</span> <span class="n">TireLinear</span><span class="p">;</span>
<span class="n">VehicleModel</span> <span class="p">=</span> <span class="n">VehicleSimpleNonlinear</span><span class="p">;</span>
<span class="n">VehicleModel</span><span class="p">.</span><span class="n">tire</span> <span class="p">=</span> <span class="n">TireModel</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that the model used in the KF algorithm is the same as the one used to represent the plant except by the tire model. The plant has a nonlinear tire model while the KF model has a linear model.</p>
<p>Simulating the KF model with the same time span.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">simulatorModel</span> <span class="p">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">VehicleModel</span><span class="p">,</span> <span class="n">TSPAN</span><span class="p">);</span>
<span class="n">simulatorModel</span><span class="p">.</span><span class="n">dPSI0</span> <span class="p">=</span> <span class="mf">0.35</span><span class="p">;</span>
<span class="n">simulatorModel</span><span class="p">.</span><span class="n">Simulate</span><span class="p">;</span>
</pre></div>
</div>
<p>Retrieving states</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">XTModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">XT</span><span class="p">;</span>
<span class="n">YTModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">YT</span><span class="p">;</span>
<span class="n">PSIModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">PSI</span><span class="p">;</span>
<span class="n">vTModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">VEL</span><span class="p">;</span>
<span class="n">ALPHATModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">ALPHAT</span><span class="p">;</span>
<span class="n">dPSIModel</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">dPSI</span><span class="p">;</span>
</pre></div>
</div>
<p>The maneuver generated by the simplified model (with the same initial conditions) is illustrated below</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gModel</span> <span class="p">=</span> <span class="n">Graphics</span><span class="p">(</span><span class="n">simulatorModel</span><span class="p">);</span>
<span class="n">gModel</span><span class="p">.</span><span class="n">TractorColor</span> <span class="p">=</span> <span class="s">&#39;g&#39;</span><span class="p">;</span>
<span class="n">gModel</span><span class="p">.</span><span class="n">Frame</span><span class="p">();</span>
</pre></div>
</div>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/KalmanFilterFrame2.svg"><img alt="_images/KalmanFilterFrame2.svg" src="_images/KalmanFilterFrame2.svg" width="70%" /></a>
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Leegend</span></p>
</div>
<p>Comparing state response of both models. The following lines plot the time response of each state of the model.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XTPlant</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XTModel</span><span class="p">,</span><span class="s">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Distance X [m]&#39;</span><span class="p">)</span>

<span class="n">f2</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">YTPlant</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">YTModel</span><span class="p">,</span><span class="s">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Distance Y [m]&#39;</span><span class="p">)</span>

<span class="n">f3</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">PSIPlant</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">PSIModel</span><span class="p">,</span><span class="s">&#39;b--&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;PSI [rad]&#39;</span><span class="p">)</span>

<span class="n">f4</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">vTPlant</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">vTModel</span><span class="p">,</span><span class="s">&#39;c--&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;vT [m/s]&#39;</span><span class="p">)</span>

<span class="n">f5</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ALPHATPlant</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">),</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ALPHATModel</span><span class="p">,</span><span class="s">&#39;m--&#39;</span><span class="p">),</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ALPHAT [rad/s]&#39;</span><span class="p">)</span>

<span class="n">f6</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">dPSIPlant</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">dPSIModel</span><span class="p">,</span><span class="s">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;dPSI [rad/s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The generated figures can be seen below.</p>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/KalmanFilterFig1.svg"><img alt="_images/KalmanFilterFig1.svg" src="_images/KalmanFilterFig1.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="_images/KalmanFilterFig2.svg"><img alt="_images/KalmanFilterFig2.svg" src="_images/KalmanFilterFig2.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id6">
<a class="reference internal image-reference" href="_images/KalmanFilterFig3.svg"><img alt="_images/KalmanFilterFig3.svg" src="_images/KalmanFilterFig3.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="_images/KalmanFilterFig4.svg"><img alt="_images/KalmanFilterFig4.svg" src="_images/KalmanFilterFig4.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="_images/KalmanFilterFig5.svg"><img alt="_images/KalmanFilterFig5.svg" src="_images/KalmanFilterFig5.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id9">
<a class="reference internal image-reference" href="_images/KalmanFilterFig6.svg"><img alt="_images/KalmanFilterFig6.svg" src="_images/KalmanFilterFig6.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Leegend</span></p>
</div>
<p>Comparing longitudinal and lateral acceleration. The acceleration of both models are calculated as</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">saidasPlant</span> <span class="p">=</span> <span class="p">[</span><span class="n">XTPlant</span> <span class="n">YTPlant</span> <span class="n">PSIPlant</span> <span class="n">vTPlant</span> <span class="n">ALPHATPlant</span> <span class="n">dPSIPlant</span><span class="p">];</span>
<span class="n">matDerivEstadosPlant</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">saidasPlant</span><span class="p">));</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">saidasPlant</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">auxil</span> <span class="p">=</span> <span class="n">simulatorPlant</span><span class="p">.</span><span class="n">Vehicle</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">saidasPlant</span><span class="p">(</span><span class="nb">i</span><span class="p">,:),</span><span class="n">TSPAN</span><span class="p">);</span>
    <span class="n">matDerivEstadosPlant</span><span class="p">(</span><span class="nb">i</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">auxil</span><span class="o">&#39;</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">dXTPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">dYTPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">dPSIPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">dvTPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">dALPHATPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">ddPSIPlant</span> <span class="p">=</span> <span class="n">matDerivEstadosPlant</span><span class="p">(:,</span><span class="mi">6</span><span class="p">);</span>

<span class="n">ddXPlant</span> <span class="p">=</span> <span class="n">dvTPlant</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIPlant</span> <span class="o">+</span> <span class="n">ALPHATPlant</span><span class="p">)</span> <span class="o">-</span> <span class="n">vTPlant</span><span class="o">.*</span><span class="p">(</span><span class="n">dPSIPlant</span> <span class="o">+</span> <span class="n">dALPHATPlant</span><span class="p">)</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIPlant</span> <span class="o">+</span> <span class="n">ALPHATPlant</span><span class="p">);</span>
<span class="n">ddYPlant</span> <span class="p">=</span> <span class="n">dvTPlant</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIPlant</span> <span class="o">+</span> <span class="n">ALPHATPlant</span><span class="p">)</span> <span class="o">+</span> <span class="n">vTPlant</span><span class="o">.*</span><span class="p">(</span><span class="n">dPSIPlant</span> <span class="o">+</span> <span class="n">dALPHATPlant</span><span class="p">)</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIPlant</span> <span class="o">+</span> <span class="n">ALPHATPlant</span><span class="p">);</span>

<span class="n">ACELNumPlant</span> <span class="p">=</span> <span class="p">[(</span><span class="n">ddXPlant</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIPlant</span><span class="p">)</span> <span class="o">-</span> <span class="n">ddYPlant</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIPlant</span><span class="p">))</span>  <span class="p">(</span><span class="o">-</span><span class="n">ddXPlant</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIPlant</span><span class="p">)</span> <span class="o">+</span> <span class="n">ddYPlant</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIPlant</span><span class="p">))];</span>

<span class="n">saidasModel</span> <span class="p">=</span> <span class="p">[</span><span class="n">XTModel</span> <span class="n">YTModel</span> <span class="n">PSIModel</span> <span class="n">vTModel</span> <span class="n">ALPHATModel</span> <span class="n">dPSIModel</span><span class="p">];</span>
<span class="n">matDerivEstadosModel</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">saidasModel</span><span class="p">));</span>
<span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">saidasModel</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">auxil</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">Vehicle</span><span class="p">.</span><span class="n">Model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">saidasModel</span><span class="p">(</span><span class="nb">i</span><span class="p">,:),</span><span class="n">TSPAN</span><span class="p">);</span>
    <span class="n">matDerivEstadosModel</span><span class="p">(</span><span class="nb">i</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">auxil</span><span class="o">&#39;</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">dXTModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">dYTModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">dPSIModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">dvTModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">dALPHATModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">ddPSIModel</span> <span class="p">=</span> <span class="n">matDerivEstadosModel</span><span class="p">(:,</span><span class="mi">6</span><span class="p">);</span>

<span class="n">ddXModel</span> <span class="p">=</span> <span class="n">dvTModel</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIModel</span> <span class="o">+</span> <span class="n">ALPHATModel</span><span class="p">)</span> <span class="o">-</span> <span class="n">vTModel</span><span class="o">.*</span><span class="p">(</span><span class="n">dPSIModel</span> <span class="o">+</span> <span class="n">dALPHATModel</span><span class="p">)</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIModel</span> <span class="o">+</span> <span class="n">ALPHATModel</span><span class="p">);</span>
<span class="n">ddYModel</span> <span class="p">=</span> <span class="n">dvTModel</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIModel</span> <span class="o">+</span> <span class="n">ALPHATModel</span><span class="p">)</span> <span class="o">+</span> <span class="n">vTModel</span><span class="o">.*</span><span class="p">(</span><span class="n">dPSIModel</span> <span class="o">+</span> <span class="n">dALPHATModel</span><span class="p">)</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIModel</span> <span class="o">+</span> <span class="n">ALPHATModel</span><span class="p">);</span>

<span class="n">ACELNumModel</span> <span class="p">=</span> <span class="p">[(</span><span class="n">ddXModel</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIModel</span><span class="p">)</span> <span class="o">-</span> <span class="n">ddYModel</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIModel</span><span class="p">))</span>  <span class="p">(</span><span class="o">-</span><span class="n">ddXModel</span><span class="o">.*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSIModel</span><span class="p">)</span> <span class="o">+</span> <span class="n">ddYModel</span><span class="o">.*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSIModel</span><span class="p">))];</span>
</pre></div>
</div>
<p>The longitudinal and lateral acceleration are plotted with</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f7</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumPlant</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumModel</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumModel</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;time [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;acc. [m/s]&#39;</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;AX Plant&#39;</span><span class="p">,</span><span class="s">&#39;AY Plant&#39;</span><span class="p">,</span><span class="s">&#39;AX Model&#39;</span><span class="p">,</span><span class="s">&#39;AY Model&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;NorthEast&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting comparison is illustrated in the figure below</p>
<div class="figure">
<img alt="_images/KalmanFilterFig7.svg" src="_images/KalmanFilterFig7.svg" /></div>
<p>Comparing the maneuvers of the plant and the model.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gPlant</span><span class="p">.</span><span class="n">Frame</span><span class="p">();</span>
<span class="n">gModel</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="s">&#39;nextplot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-center" id="id10">
<a class="reference internal image-reference" href="_images/KalmanFilterFrame3.svg"><img alt="_images/KalmanFilterFrame3.svg" src="_images/KalmanFilterFrame3.svg" width="70%" /></a>
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">Leegend</span></p>
</div>
<p>The general expression of the linearized model is optained using the symbolic processor of Octave/Matlab.</p>
<p>Defining symbols</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">syms</span> <span class="n">XT</span> <span class="n">YT</span> <span class="n">PSI</span> <span class="n">vT</span> <span class="n">ALPHAT</span> <span class="n">dPSI</span> <span class="n">mT</span> <span class="n">IT</span> <span class="n">a</span> <span class="n">b</span> <span class="n">K</span>
</pre></div>
</div>
<p>The tire slip angles are</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ALPHAF</span> <span class="p">=</span> <span class="nb">atan</span><span class="p">((</span><span class="n">vT</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">dPSI</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vT</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)));</span> <span class="c">% Front</span>
<span class="n">ALPHAR</span> <span class="p">=</span> <span class="nb">atan</span><span class="p">((</span><span class="n">vT</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">dPSI</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vT</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)));</span> <span class="c">% Rear</span>
</pre></div>
</div>
<p>The Lateral forces</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">FyF</span> <span class="p">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">ALPHAF</span><span class="p">;</span>                    <span class="c">% Front</span>
<span class="n">FyR</span> <span class="p">=</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">ALPHAR</span><span class="p">;</span>                    <span class="c">% Rear</span>
</pre></div>
</div>
<p>State equations</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f1e</span> <span class="p">=</span> <span class="n">vT</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">ALPHAT</span> <span class="o">+</span> <span class="n">PSI</span><span class="p">);</span>
<span class="n">f2e</span> <span class="p">=</span> <span class="n">vT</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">ALPHAT</span> <span class="o">+</span> <span class="n">PSI</span><span class="p">);</span>
<span class="n">f3e</span> <span class="p">=</span> <span class="n">dPSI</span><span class="p">;</span>
<span class="n">f4e</span> <span class="p">=</span> <span class="p">(</span><span class="n">FyF</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)</span> <span class="o">+</span> <span class="n">FyR</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">mT</span><span class="p">);</span>
<span class="n">f5e</span> <span class="p">=</span> <span class="p">(</span><span class="n">FyF</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)</span> <span class="o">+</span> <span class="n">FyR</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">ALPHAT</span><span class="p">)</span> <span class="o">-</span> <span class="n">mT</span> <span class="o">*</span> <span class="n">vT</span> <span class="o">*</span> <span class="n">dPSI</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mT</span> <span class="o">*</span> <span class="n">vT</span><span class="p">);</span>
<span class="n">f6e</span> <span class="p">=</span> <span class="p">(</span><span class="n">FyF</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">FyR</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">IT</span><span class="p">;</span>

<span class="n">f</span> <span class="p">=</span> <span class="p">[</span><span class="n">f1e</span> <span class="p">;</span> <span class="n">f2e</span> <span class="p">;</span> <span class="n">f3e</span> <span class="p">;</span> <span class="n">f4e</span> <span class="p">;</span> <span class="n">f5e</span> <span class="p">;</span> <span class="n">f6e</span><span class="p">];</span>
</pre></div>
</div>
<p>State vector</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">States</span> <span class="p">=</span> <span class="p">[</span><span class="n">XT</span> <span class="p">;</span> <span class="n">YT</span> <span class="p">;</span> <span class="n">PSI</span> <span class="p">;</span> <span class="n">vT</span> <span class="p">;</span> <span class="n">ALPHAT</span> <span class="p">;</span> <span class="n">dPSI</span><span class="p">];</span>
</pre></div>
</div>
<p>The linearized system is written as</p>
<div class="math notranslate nohighlight">
\[\dot{\bf x} = {\bf F} {\bf x}\]</div>
<p>where <span class="math notranslate nohighlight">\({\bf F}\)</span> is the dynamic matrix of the linear model obtained after the truncation of the expansion of the Taylor series. Thus, the <span class="math notranslate nohighlight">\({\bf F}\)</span> matrix is</p>
<div class="math notranslate nohighlight">
\[{\bf F} = \left[ \frac{\partial f_i}{\partial x_j} \right]_{n \times n}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> e <span class="math notranslate nohighlight">\(j\)</span> indicate the equations and state variables used in the calculations of at the position <span class="math notranslate nohighlight">\((i,j)\)</span> of the jacobian matrix.</p>
<p>Calculating the jacobian matrix.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="p">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">States</span><span class="p">);</span>
<span class="n">F</span> <span class="p">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">F</span><span class="p">);</span>
</pre></div>
</div>
<p>Defining a matlab function to retrieve the numerical value of F. This way is faster than using âsubsâ.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">Ffunc</span> <span class="p">=</span> <span class="n">matlabFunction</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="s">&#39;Vars&#39;</span><span class="p">,{</span><span class="n">PSI</span> <span class="n">vT</span> <span class="n">ALPHAT</span> <span class="n">dPSI</span> <span class="n">mT</span> <span class="n">IT</span> <span class="n">a</span> <span class="n">b</span> <span class="n">K</span><span class="p">});</span>
</pre></div>
</div>
<p>Hypothetically, the measured quantities are:</p>
<ul class="simple">
<li>Position X</li>
<li>Position Y</li>
<li>Yaw rate</li>
<li>Longitudinal acceleration</li>
<li>Lateral acceleration</li>
</ul>
<p>For this, we use:</p>
<div class="math notranslate nohighlight">
\[\dot{x} = v_{\rm T} \cos \left( \psi + \alpha_{\rm T} \right)\]</div>
<div class="math notranslate nohighlight">
\[\dot{y} = v_{\rm T} \sin \left( \psi + \alpha_{\rm T} \right)\]</div>
<p>Longitudinal and lateral acceleration are</p>
<div class="math notranslate nohighlight">
\[\ddot{x} = \dot{v}_{\rm T} \cos \left( \psi + \alpha_{\rm T} \right) - v_{\rm T} \left( \dot{\psi} + \dot{\alpha}_{\rm T} \right) \sin \left( \psi + \alpha_{\rm T} \right)\]</div>
<div class="math notranslate nohighlight">
\[\ddot{y} = \dot{v}_{\rm T} \sin \left( \psi + \alpha_{\rm T} \right) + v_{\rm T} \left( \dot{\psi} + \dot{\alpha}_{\rm T} \right) \cos \left( \psi + \alpha_{\rm T} \right)\]</div>
<p>Thus</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ddX</span> <span class="p">=</span> <span class="n">f4</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSI</span> <span class="o">+</span> <span class="n">ALPHAT</span><span class="p">)</span> <span class="o">-</span> <span class="n">vT</span><span class="o">*</span><span class="p">(</span><span class="n">dPSI</span> <span class="o">+</span> <span class="n">f5</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSI</span> <span class="o">+</span> <span class="n">ALPHAT</span><span class="p">);</span>
<span class="n">ddY</span> <span class="p">=</span> <span class="n">f4</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSI</span> <span class="o">+</span> <span class="n">ALPHAT</span><span class="p">)</span> <span class="o">+</span> <span class="n">vT</span><span class="o">*</span><span class="p">(</span><span class="n">dPSI</span> <span class="o">+</span> <span class="n">f5</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSI</span> <span class="o">+</span> <span class="n">ALPHAT</span><span class="p">);</span>
</pre></div>
</div>
<p>The equations above describe the dynamics from <span class="math notranslate nohighlight">\(\{ O {\bf i} {\bf j} {\bf k} \}\)</span>. In the moving reference frame <span class="math notranslate nohighlight">\(\{ O {\bf t}_x {\bf t}_y {\bf t}_z \}\)</span> the equations are</p>
<div class="math notranslate nohighlight">
\[{\bf a} = \left( \ddot{x} \cos \psi - \ddot{y} \sin \psi \right) {\bf t}_x + \left( - \ddot{x} \sin \psi + \ddot{y} \sin \psi \right) {\bf t}_y\]</div>
<p>Thus,</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">ACEL</span> <span class="p">=</span> <span class="p">[</span><span class="n">ddX</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSI</span><span class="p">)</span> <span class="o">-</span> <span class="n">ddY</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSI</span><span class="p">)</span> <span class="p">;</span> <span class="o">-</span><span class="n">ddX</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">PSI</span><span class="p">)</span> <span class="o">+</span> <span class="n">ddY</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">PSI</span><span class="p">)];</span>
<span class="n">ACEL</span> <span class="p">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">ACEL</span><span class="p">);</span>
</pre></div>
</div>
<p>The nonlinear observation equation is given by</p>
<div class="math notranslate nohighlight">
\[{\bf z}_k = {\bf h} ({\bf x}_k) + {\bf v}_k\]</div>
<p>with <span class="math notranslate nohighlight">\({\bf v}_k $ ~ $ N ( {\bf 0} , {\bf R}_k )\)</span>.</p>
<p>The linear version is given by</p>
<div class="math notranslate nohighlight">
\[{\bf z}_k = {\bf H} {\bf x}_k + {\bf v}_k\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[{\bf H} = \left[ \frac{\partial h_i}{\partial x_j} \right]_{m \times n}\]</div>
<p>that is, the output matrix <span class="math notranslate nohighlight">\({\bf H}\)</span> is the jacobian matrix of the ACEL equation in relation to the system states.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">medNonlinear</span> <span class="p">=</span> <span class="p">[</span><span class="n">XT</span> <span class="p">;</span> <span class="n">YT</span> <span class="p">;</span> <span class="n">f6</span> <span class="p">;</span> <span class="n">ACEL</span><span class="p">];</span>

<span class="n">H</span> <span class="p">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">medNonlinear</span><span class="p">,</span><span class="n">States</span><span class="p">);</span>
<span class="n">H</span> <span class="p">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>
</pre></div>
</div>
<p>Again, defining matlab functions to retrieve the numerical value of medNonlinearfunc and H.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">medNonlinearfunc</span> <span class="p">=</span> <span class="n">matlabFunction</span><span class="p">(</span><span class="n">medNonlinear</span><span class="p">,</span><span class="s">&#39;Vars&#39;</span><span class="p">,{</span><span class="n">XT</span> <span class="n">YT</span> <span class="n">PSI</span> <span class="n">vT</span> <span class="n">ALPHAT</span> <span class="n">dPSI</span> <span class="n">mT</span> <span class="n">IT</span> <span class="n">a</span> <span class="n">b</span> <span class="n">K</span><span class="p">});</span>

<span class="n">Hfunc</span> <span class="p">=</span> <span class="n">matlabFunction</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="s">&#39;Vars&#39;</span><span class="p">,{</span><span class="n">PSI</span> <span class="n">vT</span> <span class="n">ALPHAT</span> <span class="n">dPSI</span> <span class="n">mT</span> <span class="n">IT</span> <span class="n">a</span> <span class="n">b</span> <span class="n">K</span><span class="p">});</span>
</pre></div>
</div>
<p>Implementing the algorithm</p>
<p>Noise matrix</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="p">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>                         <span class="c">% Identity matrix (6 x 6)</span>
</pre></div>
</div>
<p>Covariance matrices</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">Q</span> <span class="p">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<span class="n">R</span> <span class="p">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
<p>Matrix</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">P0</span> <span class="p">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
</pre></div>
</div>
<p>Retrieving the initial conditions defined above.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">X0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">X0</span><span class="p">;</span>
<span class="n">Y0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">Y0</span><span class="p">;</span>
<span class="n">PSI0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">PSI0</span><span class="p">;</span>
<span class="n">VEL0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">V0</span><span class="p">;</span>
<span class="n">ALPHAT0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">ALPHAT0</span><span class="p">;</span>
<span class="n">dPSI0Num</span> <span class="p">=</span> <span class="n">simulatorModel</span><span class="p">.</span><span class="n">dPSI0</span><span class="p">;</span>

<span class="n">x0</span> <span class="p">=</span> <span class="p">[</span> <span class="n">X0Num</span> <span class="p">;</span> <span class="n">Y0Num</span> <span class="p">;</span> <span class="n">PSI0Num</span> <span class="p">;</span> <span class="n">VEL0Num</span> <span class="p">;</span> <span class="n">ALPHAT0Num</span> <span class="p">;</span> <span class="n">dPSI0Num</span> <span class="p">];</span>
<span class="n">x0</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">x0</span><span class="p">(</span><span class="mi">4</span><span class="p">)=</span><span class="mi">20</span><span class="p">;</span>
</pre></div>
</div>
<p>Retrieving the vehicle parameters.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">mTNum</span> <span class="p">=</span> <span class="n">VehicleModel</span><span class="p">.</span><span class="n">mT</span><span class="p">;</span>
<span class="n">ITNum</span> <span class="p">=</span> <span class="n">VehicleModel</span><span class="p">.</span><span class="n">IT</span><span class="p">;</span>
<span class="n">aNum</span> <span class="p">=</span> <span class="n">VehicleModel</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<span class="n">bNum</span> <span class="p">=</span> <span class="n">VehicleModel</span><span class="p">.</span><span class="n">b</span><span class="p">;</span>
<span class="n">KNum</span> <span class="p">=</span> <span class="n">TireModel</span><span class="p">.</span><span class="n">k</span><span class="p">;</span>

<span class="n">parameters</span> <span class="p">=</span> <span class="p">[</span><span class="n">mTNum</span> <span class="n">ITNum</span> <span class="n">aNum</span> <span class="n">bNum</span> <span class="n">KNum</span><span class="p">];</span>
</pre></div>
</div>
<p>Sample time</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">sampleTime</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">t</span> <span class="p">=</span> <span class="mi">0</span><span class="p">:</span><span class="n">sampleTime</span><span class="p">:</span><span class="n">T</span><span class="p">;</span>                 <span class="c">% Array of observation instants</span>
</pre></div>
</div>
<p>Preallocation</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">XOUTopt</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="n">States</span><span class="p">));</span>  <span class="c">% Estimate of the states after update</span>
<span class="n">Popt</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>                  <span class="c">% Covariance matrix after update</span>
<span class="n">Pantes</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>                <span class="c">% Covariance matrix before update</span>
<span class="n">KKalmanopt</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>             <span class="c">% Kalman gain</span>
</pre></div>
</div>
<p>Using the first values</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">x0</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">XOUTantes</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">x0</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">Pantes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">P0</span><span class="p">);</span>
<span class="n">Popt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">P0</span><span class="p">);</span>
</pre></div>
</div>
<p>Error distribution</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">pesos</span> <span class="p">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">;</span> <span class="mi">5</span><span class="p">;</span> <span class="mf">0.1</span><span class="p">;</span> <span class="mf">0.5</span><span class="p">;</span> <span class="mf">0.5</span><span class="p">];</span>
</pre></div>
</div>
<p>Iterations</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="c">% Index varying through all instants of observation</span>

    <span class="c">% Time span for the propagation phase</span>
    <span class="n">tspan</span> <span class="p">=</span> <span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">):</span><span class="n">sampleTime</span><span class="o">/</span><span class="mi">100</span><span class="p">:</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">+</span><span class="n">sampleTime</span><span class="p">;</span>

    <span class="c">% Measures of the interation</span>
    <span class="n">z</span> <span class="p">=</span> <span class="p">[</span><span class="n">interp1</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XTPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">))</span> <span class="p">;</span>
         <span class="n">interp1</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">YTPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">))</span> <span class="p">;</span>
         <span class="n">interp1</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ddPSIPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">))</span> <span class="p">;</span>
         <span class="n">interp1</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">))</span> <span class="p">;</span>
         <span class="n">interp1</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">ACELNumPlant</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">t</span><span class="p">(</span><span class="nb">j</span><span class="p">))];</span>

    <span class="n">z</span> <span class="p">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">pesos</span><span class="o">.*</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">);</span>

    <span class="n">Fnum</span> <span class="p">=</span> <span class="n">Ffunc</span><span class="p">(</span><span class="n">PSI0Num</span><span class="p">,</span><span class="n">VEL0Num</span><span class="p">,</span><span class="n">ALPHAT0Num</span><span class="p">,</span><span class="n">dPSI0Num</span><span class="p">,</span><span class="n">mTNum</span><span class="p">,</span><span class="n">ITNum</span><span class="p">,</span><span class="n">aNum</span><span class="p">,</span><span class="n">bNum</span><span class="p">,</span><span class="n">KNum</span><span class="p">);</span>
    <span class="n">Hnum</span> <span class="p">=</span> <span class="n">Hfunc</span><span class="p">(</span><span class="n">PSI0Num</span><span class="p">,</span><span class="n">VEL0Num</span><span class="p">,</span><span class="n">ALPHAT0Num</span><span class="p">,</span><span class="n">dPSI0Num</span><span class="p">,</span><span class="n">mTNum</span><span class="p">,</span><span class="n">ITNum</span><span class="p">,</span><span class="n">aNum</span><span class="p">,</span><span class="n">bNum</span><span class="p">,</span><span class="n">KNum</span><span class="p">);</span>

    <span class="c">% Propagation cycle</span>
    <span class="c">% Transforming matrix PMat0 (6 x 6) in P0 (1 x 36)</span>
    <span class="n">P0</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">P0</span><span class="o">&#39;</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">36</span><span class="p">]);</span>

    <span class="p">[</span><span class="n">TOUT</span><span class="p">,</span><span class="n">Pout</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode45</span><span class="p">(@(</span><span class="n">t</span><span class="p">,</span><span class="n">P</span><span class="p">)</span> <span class="n">IntCov</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">Fnum</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">Q</span><span class="p">),</span><span class="n">tspan</span><span class="p">,</span><span class="n">P0</span><span class="p">);</span>

    <span class="n">Pmatrix</span> <span class="p">=</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">Pout</span><span class="p">(</span><span class="k">end</span><span class="p">,:),[</span><span class="mi">6</span> <span class="mi">6</span><span class="p">])</span><span class="o">&#39;</span><span class="p">;</span>

    <span class="n">simulatorKalman</span> <span class="p">=</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">VehicleModel</span><span class="p">,</span> <span class="n">tspan</span><span class="p">);</span>

    <span class="c">% Initial conditions</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">X0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">Y0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">PSI0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">V0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">ALPHAT0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">dPSI0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>

    <span class="c">% Simulation</span>
    <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">Simulate</span><span class="p">()</span>

    <span class="n">XTKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">XT</span><span class="p">;</span>
    <span class="n">YTKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">YT</span><span class="p">;</span>
    <span class="n">PSIKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">PSI</span><span class="p">;</span>
    <span class="n">vTKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">VEL</span><span class="p">;</span>
    <span class="n">ALPHATKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">ALPHAT</span><span class="p">;</span>
    <span class="n">dPSIKalman</span> <span class="p">=</span> <span class="n">simulatorKalman</span><span class="p">.</span><span class="n">dPSI</span><span class="p">;</span>

    <span class="n">XOUTKalman</span> <span class="p">=</span> <span class="p">[</span><span class="n">XTKalman</span> <span class="n">YTKalman</span> <span class="n">PSIKalman</span> <span class="n">vTKalman</span> <span class="n">ALPHATKalman</span> <span class="n">dPSIKalman</span><span class="p">];</span>

    <span class="c">% Update cycle</span>

    <span class="n">ACELKalman</span> <span class="p">=</span> <span class="n">medNonlinearfunc</span><span class="p">(</span><span class="n">XTKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">YTKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">PSIKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">vTKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">ALPHATKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">dPSIKalman</span><span class="p">(</span><span class="k">end</span><span class="p">),</span>
                                  <span class="n">mTNum</span><span class="p">,</span>
                                  <span class="n">ITNum</span><span class="p">,</span>
                                  <span class="n">aNum</span><span class="p">,</span>
                                  <span class="n">bNum</span><span class="p">,</span>
                                  <span class="n">KNum</span><span class="p">);</span>

    <span class="n">KKalman</span> <span class="p">=</span> <span class="n">Pmatrix</span><span class="o">*</span><span class="n">Hnum</span><span class="o">&#39;</span> <span class="o">/</span> <span class="p">(</span><span class="n">Hnum</span><span class="o">*</span><span class="n">Pmatrix</span><span class="o">*</span><span class="n">Hnum</span><span class="o">&#39;</span> <span class="o">+</span> <span class="n">R</span><span class="p">);</span>

    <span class="n">XKalman</span> <span class="p">=</span> <span class="n">XOUTKalman</span><span class="p">(</span><span class="k">end</span><span class="p">,:)</span><span class="o">&#39;</span> <span class="o">+</span> <span class="n">KKalman</span><span class="o">*</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">ACELKalman</span><span class="p">);</span>
    <span class="n">PKalman</span> <span class="p">=</span> <span class="n">Pmatrix</span> <span class="o">-</span> <span class="n">KKalman</span><span class="o">*</span><span class="n">Hnum</span><span class="o">*</span><span class="n">Pmatrix</span><span class="p">;</span>

    <span class="n">x0</span> <span class="p">=</span> <span class="n">XKalman</span><span class="p">;</span>
    <span class="n">P0</span> <span class="p">=</span> <span class="n">PKalman</span><span class="p">;</span>

    <span class="n">XOUTopt</span><span class="p">(</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">XKalman</span><span class="o">&#39;</span><span class="p">;</span>
    <span class="n">XOUTantes</span><span class="p">(</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,:)</span> <span class="p">=</span> <span class="n">XOUTKalman</span><span class="p">(</span><span class="k">end</span><span class="p">,:);</span>
    <span class="n">Popt</span><span class="p">(</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">PKalman</span><span class="p">);</span>
    <span class="n">Pantes</span><span class="p">(</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">Pmatrix</span><span class="p">);</span>
    <span class="n">KKalmanopt</span><span class="p">(</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">KKalman</span><span class="p">);</span>

<span class="k">end</span>
</pre></div>
</div>
<p>Comparison</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f8</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;x [m]&#39;</span><span class="p">)</span>

<span class="n">f9</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;g--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y [m]&#39;</span><span class="p">)</span>

<span class="n">f10</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s">&#39;b--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;PSI [rad]&#39;</span><span class="p">)</span>

<span class="n">f11</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="s">&#39;c--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;vT [m/s]&#39;</span><span class="p">)</span>

<span class="n">f12</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">5</span><span class="p">),</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="s">&#39;m--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ALPHAT [rad/s]&#39;</span><span class="p">)</span>

<span class="n">f13</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">TSPAN</span><span class="p">,</span><span class="n">XOUTPlant</span><span class="p">(:,</span><span class="mi">6</span><span class="p">),</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">XOUTopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="s">&#39;k--&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;Plant&#39;</span><span class="p">,</span><span class="s">&#39;Estim&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;dPSI [rad/s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Cov. do erro</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">f14</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">KKalmanopt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ganho de kalman&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>

<span class="n">f15</span> <span class="p">=</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">ax</span> <span class="p">=</span> <span class="n">gca</span><span class="p">;</span>
<span class="n">set</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;NextPlot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">,</span><span class="s">&#39;Box&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;XGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="s">&#39;YGrid&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">Popt</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="n">Pantes</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Marker&#39;</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">l</span> <span class="p">=</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">);</span>
<span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;NorthEast&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;cov. erro&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;tempo [s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting plots can be seen below</p>
<div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="_images/KalmanFilterFig8.svg"><img alt="_images/KalmanFilterFig8.svg" src="_images/KalmanFilterFig8.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id12">
<a class="reference internal image-reference" href="_images/KalmanFilterFig9.svg"><img alt="_images/KalmanFilterFig9.svg" src="_images/KalmanFilterFig9.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id13">
<a class="reference internal image-reference" href="_images/KalmanFilterFig10.svg"><img alt="_images/KalmanFilterFig10.svg" src="_images/KalmanFilterFig10.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id14">
<a class="reference internal image-reference" href="_images/KalmanFilterFig11.svg"><img alt="_images/KalmanFilterFig11.svg" src="_images/KalmanFilterFig11.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id15">
<a class="reference internal image-reference" href="_images/KalmanFilterFig12.svg"><img alt="_images/KalmanFilterFig12.svg" src="_images/KalmanFilterFig12.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 16 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id16">
<a class="reference internal image-reference" href="_images/KalmanFilterFig13.svg"><img alt="_images/KalmanFilterFig13.svg" src="_images/KalmanFilterFig13.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id17">
<a class="reference internal image-reference" href="_images/KalmanFilterFig14.svg"><img alt="_images/KalmanFilterFig14.svg" src="_images/KalmanFilterFig14.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 18 </span><span class="caption-text">Leegend</span></p>
</div>
<div class="figure align-center" id="id18">
<a class="reference internal image-reference" href="_images/KalmanFilterFig15.svg"><img alt="_images/KalmanFilterFig15.svg" src="_images/KalmanFilterFig15.svg" width="40%" /></a>
<p class="caption"><span class="caption-number">Fig. 19 </span><span class="caption-text">Leegend</span></p>
</div>
<p>Estimated trajectory</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">gKalman</span> <span class="p">=</span> <span class="n">Graphics</span><span class="p">(</span><span class="n">simulatorKalman</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">TSpan</span> <span class="p">=</span> <span class="n">t</span><span class="p">;</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">XT</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">YT</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">PSI</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">VEL</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">ALPHAT</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Simulator</span><span class="p">.</span><span class="n">dPSI</span> <span class="p">=</span> <span class="n">XOUTopt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">TractorColor</span> <span class="p">=</span> <span class="s">&#39;b&#39;</span><span class="p">;</span>

<span class="n">gPlant</span><span class="p">.</span><span class="n">Frame</span><span class="p">();</span>
<span class="n">gKalman</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="s">&#39;nextplot&#39;</span><span class="p">,</span><span class="s">&#39;add&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="figure align-center" id="id19">
<a class="reference internal image-reference" href="_images/KalmanFilterFrame4.svg"><img alt="_images/KalmanFilterFrame4.svg" src="_images/KalmanFilterFrame4.svg" width="70%" /></a>
<p class="caption"><span class="caption-number">Fig. 20 </span><span class="caption-text">Leegend</span></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="example.html"
                          title="Previous page">&larr; Examples</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="exampleSinusoidalSteering.html"
                          title="Next page">&rarr; Sinusoidal Steering</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/exampleKalmanFilter.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 Â«
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 Â»
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="exampleSinusoidalSteering.html" title="Sinusoidal Steering"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="example.html" title="Examples"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">OpenVD  documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="example.html" >Examples</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, BSD 3-clause.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>